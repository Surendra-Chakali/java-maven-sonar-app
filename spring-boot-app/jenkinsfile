pipeline {
    agent any
    tools{
        maven 'maven1'
    }
    stages {

        stage('Code-Build') {
            steps {
               sh "cd spring-boot-app && mvn clean package"
            }
        }


        stage('Build and Push Docker Image') {
          environment {
            DOCKER_IMAGE = "surendra548/jenkinscicd:${BUILD_NUMBER}"
            CREDS = credentials('dockerCreds')
           }
           steps {
               script{
                docker.withRegistry('https://index.docker.io/v1/',"dockerCreds") {
                    sh 'docker build -t ${DOCKER_IMAGE} spring-boot-app/.'
                    sh 'docker push ${DOCKER_IMAGE}'
                }
              }
          }
        }
        
    }
}
